package data.datahelper.impl;
/**
 * @author bxh
 * 现在这个方法只实现了get data set data和update
 * 问题：1.update这里是一起进行更新 逻辑上是否选择一次更新部分
 *      2.map那里用了迭代器 但是是否要进行全部遍历 还是说一条条实现
 *      3.set中不使用map是否合理？？？
 */
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.HashMap;
import java.util.Iterator;
import java.util.Map;

import data.datahelper.UserDataHelper;
import po.UserPo;

public class UserDataMysqlHelper implements UserDataHelper {
	static String sql = null;  
	static JDBCHelper db1 = null;  
	static ResultSet ret = null;  

	@Override
	public Map<Integer, UserPo> getUserData() {
		// TODO Auto-generated method stub
		sql = "select *from user";//SQL语句  
	    db1 = new JDBCHelper(sql);//创建DBHelper对象  
	    Map<Integer,UserPo> map = new HashMap<Integer, UserPo>();

	    try {  
	    	ret = db1.pst.executeQuery();//执行语句，得到结果集  
	    	while (ret.next()) {  
	    		int id = ret.getInt(1);  
	    		String name = ret.getString(2);  
	    		String password = ret.getString(3);  
	    		String contactinfo = ret.getString(4); 
	    		int credit = ret.getInt(5);
	    		boolean isVIP ;
	    		if(ret.getInt(6)==0)
	    			isVIP = false;
	    		else
	    			isVIP = true;
	    		UserPo userPo=new UserPo(id, password, contactinfo, name, credit,isVIP);
	    		map.put(id,userPo);
	          }//显示数据  
	          ret.close();  
	          db1.close();//关闭连接  
	      } catch (SQLException e) {  
	          e.printStackTrace();  
	      }  
	  
		return map;
	}

	@Override
	public void setNewUserData(UserPo userPo) {
			// TODO Auto-generated method stub
			sql = "insert into table user value ("+userPo.getID()+","+userPo.getPassword();//SQL语句  
		    db1 = new JDBCHelper(sql);//创建DBHelper对象  

		    try {  
		    	ret = db1.pst.executeQuery();//执行语句，得到结果集  

		          ret.close();  
		          db1.close();//关闭连接  
		      } catch (SQLException e) {  
		          e.printStackTrace();  
		      }
	}
	
	@Override
	public void updateUserData(Map<Integer, UserPo> map) {
		Iterator<Map.Entry<Integer, UserPo>> iterator = map.entrySet().iterator();
	    while(iterator.hasNext()){
			Map.Entry<Integer, UserPo> entry = iterator.next();
			UserPo userPo = entry.getValue();
			sql = "update user set name = "+userPo.getUsername()+", password = "+userPo.getPassword()+ ", contactinfo = "+userPo.getPhone()+", credit = "+userPo.getCredit()+"where id = "+userPo.getID();//SQL语句  
		    db1 = new JDBCHelper(sql);//创建DBHelper对象 
		    try{
		    ret = db1.pst.executeUpdate(sql);//执行语句，得到结果集  
		    }catch (SQLException e) {  
		          e.printStackTrace();  
		     }
		}
	     db1.close();//关闭连接    
	}

}
