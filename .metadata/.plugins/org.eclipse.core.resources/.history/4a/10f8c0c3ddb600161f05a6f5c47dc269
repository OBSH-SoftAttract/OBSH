package data.dao.impl;
import java.util.ArrayList;
import java.util.Iterator;
import java.util.List;
/**
 * 这个模块会有很大的改动
 * 表的结构变化 客户id 时间 符号 变化的信用 信用值 到时候返回的是list 
 * 逻辑上不知道能否按照时间将他们排序 这样的一个表中没有主键
 * 这样信用值的查找和返回应用user模块userPo。getCredit
 * 暂时没有改
 */
import java.util.Map;
import java.util.Map.Entry;

import data.dao.CreditDao;
import data.datahelper.CreditDataHelper;
import data.datahelper.DataFactory;
import data.datahelper.impl.DataFactoryImpl;
import po.CreditPo;
import po.OrderPo;

public class CreditDaoImpl implements CreditDao {
	
	private Map<Integer,CreditPo> map;
	
	private CreditDataHelper creditDataHelper;
	
	private DataFactory dataFactory;
	
	private static CreditDaoImpl creditDataServiceImpl;
	
	public static CreditDaoImpl getInstance(){
		if(creditDataServiceImpl == null){
			creditDataServiceImpl = new CreditDaoImpl();
		}
		return creditDataServiceImpl;
	}
	
	public CreditDaoImpl(){
		if(map == null){
			dataFactory = new DataFactoryImpl();
			creditDataHelper = dataFactory.getCreditDataHelper();
			map = creditDataHelper.getCreditData();
		}
	}
	
	@Override
	public List<CreditPo> getCredit(int userId) {
		// TODO Auto-generated method stub
		
		List<OrderPo> orders = new ArrayList<OrderPo>();
		Iterator<Entry<String, OrderPo>> iterator = map.entrySet().iterator();
		while(iterator.hasNext()){
			Entry<String, OrderPo> entry = iterator.next();
			OrderPo orderPo = entry.getValue();
			
			if(orderPo.getHotelID()==hotelId)
				orders.add(orderPo);
		}
		return orders;
	}
	
	@Override
	public boolean addCredit(CreditPo creditPo) {
		// TODO Auto-generated method stub
		
		int userId = creditPo.getUserId();
		if(map.get(userId)==null) {
			creditDataHelper.addCreditData(creditPo);
			return true;
		}
		return false;
	}
}
